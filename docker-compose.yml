version: '2.1'
services:
  transformer-runner:
    build: ./transformer-runner
    restart: always
    privileged: true
    volumes:
      - shared:/shared
    labels:
      io.balena.features.supervisor-api: '1'
    environment:
      REGISTRY_HOST: "registry"
      REGISTRY_PORT: "5000"
      MOCK_JF_SDK: "true"

  # The registry is needed for dev only
  registry:
    image: "registry:2.7.1"
    volumes:
      - "registry-data:/data"

  dev-artifact-provider:
    build: ./dev-artifact-provider
    privileged: true
    environment:
      REGISTRY_HOST: "registry"
      REGISTRY_PORT: "5000"
    depends_on:
      - registry

volumes:
  registry-data: {}
  garbage-collector: {}
  shared: {}
